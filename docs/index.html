<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EmbiggenEye — Explorer</title>

  <!-- App CSS -->
  <link rel="stylesheet" href="styles.css">

  <!-- Leaflet + MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

  <!-- Icons (optional) -->
  <link rel="stylesheet" href="https://unpkg.com/feather-icons/dist/feather.min.css" />

  <style>
    /* Safety - ensures map is visible even if styles.css fails to load */
    html,body { height: 100%; margin: 0; background: #0b0e16; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    main { display: grid; grid-template-columns: 300px 1fr 320px; gap: 12px; height: calc(100% - 120px); padding: 12px; box-sizing: border-box; }
    #map { width: 100%; height: 100%; min-height: 480px; border-radius: 8px; overflow: hidden; }
    .topbar { display:flex; align-items:center; justify-content:space-between; padding:10px 16px; background:linear-gradient(90deg,#071025 0%, #0b1320 100%); color:#fff; gap:12px; }
    .leftpanel, .rightpanel { overflow:auto; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:10px; padding:10px; color:#dbe9ff; }
    .btn { background:#1f6feb; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-weight:600; }
    .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#cfe4ff; }
    .logo { height:40px; border-radius:6px; }
    .search input { padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.06); background:rgba(255,255,255,0.02); color:#e8f4ff; }
    .layers label { display:block; margin:6px 0; font-size:14px; color:#cfe4ff; }
    .legend-row { margin:6px 0; color:#cfe4ff; font-size:13px; }
    .swatch { display:inline-block; width:18px; height:12px; margin-right:8px; vertical-align:middle; }
    .swatch.low { background:#2b6cff }
    .swatch.mid { background:#ffd166 }
    .swatch.high { background:#ff6b6b }
    .panel-footer { margin-top:12px; color:#9fb; font-size:12px }
    #toast { position: fixed; right: 12px; top: 82px; padding: 8px 12px; background: rgba(0,0,0,0.6); color: #fff; border-radius: 8px; z-index: 2000; display: none; }
    #toast.visible { display:block; animation: fadein .18s ease-out; }
    @keyframes fadein { from { transform: translateY(-6px); opacity:0 } to { transform: translateY(0); opacity:1 } }
    .popup-card h4 { margin:0 0 6px 0; }
    .popup-table td { padding:2px 6px; }
    .feature-details .empty { color:#9fb; }
    .pulse { animation: pulse 1.4s infinite; }
    @keyframes pulse { 0% { transform: scale(1); opacity:1 } 70% { transform: scale(1.35); opacity:0.25 } 100% { transform: scale(1); opacity:0 } }
    /* loader (hidden by default) */
    #loader { position: fixed; left: 12px; top: 72px; padding: 8px 12px; background: rgba(0,0,0,0.6); color: #fff; border-radius: 8px; z-index: 2000; display: none; font-size: 13px; }
  </style>
</head>
<body>
  <div id="app">
    <header class="topbar">
      <div class="brand" style="display:flex;align-items:center;gap:10px;">
        <img src="static/logo.png" alt="EmbiggenEye" class="logo" onerror="this.style.display='none'" />
        <div style="line-height:1">
          <div style="font-weight:700;font-size:18px">EmbiggenEye</div>
          <div style="font-size:12px;color:#bcd">Lunar crater water-likelihood explorer</div>
        </div>
      </div>

      <div class="controls" style="display:flex;align-items:center;gap:8px;">
        <div class="search" style="display:flex;gap:6px;">
          <input id="searchInput" placeholder="Search crater name or id..." aria-label="Search" style="padding:6px 8px;border-radius:6px;border:none;min-width:220px" />
          <button id="searchBtn" class="btn ghost">Search</button>
        </div>

        <div class="actions" style="display:flex;gap:6px;margin-left:8px;">
          <button id="suggestBtn" class="btn">Suggest</button>
          <button id="exportBtn" class="btn ghost">Export</button>
          <button id="helpBtn" class="btn ghost">Help</button>
        </div>
      </div>
    </header>

    <main>
      <aside class="leftpanel card" style="padding:12px;">
        <div class="panel-section">
          <h4>Layers</h4>
          <div class="layers">
            <label><input type="radio" name="layer" value="vis" checked> Visible</label><br/>
            <label><input type="radio" name="layer" value="ir" disabled> IR (add later)</label><br/>
            <label><input type="radio" name="layer" value="elev" disabled> Elevation (add later)</label><br/>
            <label><input type="radio" name="layer" value="index" disabled> Water-index (add later)</label>
          </div>
        </div>

        <div class="panel-section" style="margin-top:12px;">
          <h4>Legend</h4>
          <div class="legend">
            <div class="legend-row"><span class="swatch low" style="display:inline-block;width:18px;height:12px;background:#2b6cff;margin-right:8px"></span> Low water_score</div>
            <div class="legend-row"><span class="swatch mid" style="display:inline-block;width:18px;height:12px;background:#ffd166;margin-right:8px"></span> Medium</div>
            <div class="legend-row"><span class="swatch high" style="display:inline-block;width:18px;height:12px;background:#ff6b6b;margin-right:8px"></span> High water_score</div>
          </div>
        </div>

        <div class="panel-section" style="margin-top:12px;">
          <h4>Annotations</h4>
          <div id="annotationsList">None yet</div>
        </div>

        <footer class="panel-footer" style="margin-top:12px">
          <small>Demo-ready. Add IR/Elev/index tiles anytime — UI is flexible.</small>
        </footer>
      </aside>

      <section id="mapContainer">
        <div id="map"></div>
      </section>

      <aside class="rightpanel card" style="padding:12px;">
        <div id="featureDetails" class="feature-details">
          <div class="empty">Click a crater to view details</div>
        </div>
      </aside>
    </main>

    <div id="toast" class="toast" aria-live="polite" role="status"></div>
    <div id="loader">Loading features…</div>

    <footer class="bottombar" style="padding:10px 16px;background:#06121a;color:#9fb;">
      <div>EmbiggenEye • Demo build — GitHub Pages friendly</div>
      <div class="small">Tip: use the Suggest button to reveal precomputed candidates</div>
    </footer>
  </div>

  <!-- Leaflet and plugins (scripts loaded in correct order) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <!-- Your app (must come after Leaflet) -->
  <script src="app.js"></script>

  <noscript>
    <div style="position:fixed;left:12px;bottom:12px;padding:8px;background:#fffa;backdrop-filter:blur(4px);border-radius:8px;">
      JavaScript is required to view the map. Please enable JS and reload the page.
    </div>
  </noscript>
</body>
</html>
